﻿service timestamps debug datetime msec
service timestamps log datetime msec
no service password-encryption
!
hostname ISP2-AS2-R3
!
boot-start-marker
boot-end-marker
!
!
enable secret laboratorio
!
no aaa new-model
mmi polling-interval 60
no mmi auto-configure
no mmi pvc
mmi snmp-timeout 180
!
!
!
!
!
!
!
!
!
!
!
!
no ip domain lookup
ip domain name lab
ip cef
ipv6 unicast-routing
ipv6 cef
!
multilink bundle-name authenticated
no mpls ldp advertise-labels
mpls ldp advertise-labels for LDP_acl
no mpls ip propagate-ttl forwarded
!
!
!
!
!
!
!
!
username operador privilege 15 secret laboratorio
!
redundancy
!
!
ip ssh version 2
!
class-map match-all CoPP-IBGP
 match access-group name CoPP-IBGP-ACL
class-map match-any CoPP-BGP-UNTRUSTED
 match access-group name CoPP-BGP-UNTRUSTED-ACL
!
policy-map CoPP-AS2
 class CoPP-IBGP
  police 256000 64000 conform-action transmit  exceed-action drop 
 class CoPP-BGP-UNTRUSTED
  police 8000 conform-action drop  exceed-action drop 
!
! 
!
!
!
!
!
!
!
!
!
!
!
!
interface Loopback0
 ip address 2.2.255.3 255.255.255.255
 ipv6 address 2001:2:2:255::3/128
 ospfv3 1 ipv6 area 0.0.0.0
 ospfv3 1 ipv4 area 0.0.0.0
!
interface Loopback11
 ip address 2.2.11.1 255.255.255.0
 ipv6 address 2001:2:2:11::1/64
!
interface Loopback12
 ip address 2.2.12.1 255.255.255.0
 ipv6 address 2001:2:2:12::1/64
!
interface Loopback13
 ip address 2.2.13.1 255.255.255.0
 ipv6 address 2001:2:2:13::1/64
!
interface Loopback14
 ip address 2.2.14.1 255.255.255.0
 ipv6 address 2001:2:2:14::1/64
!
interface Loopback15
 ip address 2.2.15.1 255.255.255.0
 ipv6 address 2001:2:2:15::1/64
!
interface Loopback16
 ip address 2.2.16.1 255.255.255.0
 ipv6 address 2001:2:2:16::1/64
!
interface Ethernet0/0
 description ISP2-AS2-R4
 ip address 2.2.0.13 255.255.255.252
 ipv6 address 2001:2:2::D/126
 mpls ip
 ospfv3 network point-to-point
 ospfv3 1 ipv6 area 0.0.0.0
 ospfv3 1 ipv4 area 0.0.0.0
 no shutdown
!
interface Ethernet0/1
 description ISP2-AS2-R1
 ip address 2.2.0.6 255.255.255.252
 ipv6 address 2001:2:2::6/126
 mpls ip
 ospfv3 network point-to-point
 ospfv3 1 ipv6 area 0.0.0.0
 ospfv3 1 ipv4 area 0.0.0.0
 no shutdown
!
interface Ethernet0/2
 no ip address
 shutdown
!
interface Ethernet0/3
 no ip address
 shutdown
!
interface Ethernet1/0
 no ip address
 shutdown
!
interface Ethernet1/1
 no ip address
 shutdown
!
interface Ethernet1/2
 no ip address
 shutdown
!
interface Ethernet1/3
 no ip address
 shutdown
!
router ospfv3 1
 router-id 2.2.255.3
 !
 address-family ipv4 unicast
  passive-interface Loopback0
 exit-address-family
 !
 address-family ipv6 unicast
  passive-interface Loopback0
 exit-address-family
!
router bgp 2
 template peer-policy IBGP-PEER-POLICY
  route-reflector-client
  next-hop-self
  send-community both
 exit-peer-policy
 !
 template peer-session IBGP-PEER-SESSION
  remote-as 2
  cluster-id 0.0.0.23
  update-source Loopback0
 exit-peer-session
 !
 bgp router-id 2.2.255.3
 bgp cluster-id 23
 bgp log-neighbor-changes
 neighbor IBGP-IPV6 peer-group
 neighbor IBGP-IPV6 remote-as 2
 neighbor IBGP-IPV6 update-source Loopback0
 neighbor 2.2.255.1 inherit peer-session IBGP-PEER-SESSION
 neighbor 2.2.255.1 description AS2-R1
 neighbor 2.2.255.2 inherit peer-session IBGP-PEER-SESSION
 neighbor 2.2.255.2 description AS2-R2
 neighbor 2.2.255.4 inherit peer-session IBGP-PEER-SESSION
 neighbor 2.2.255.4 description AS2-R4
 neighbor 2001:2:2:255::1 peer-group IBGP-IPV6
 neighbor 2001:2:2:255::1 description AS2-R1
 neighbor 2001:2:2:255::2 peer-group IBGP-IPV6
 neighbor 2001:2:2:255::2 description AS2-R2
 neighbor 2001:2:2:255::4 peer-group IBGP-IPV6
 neighbor 2001:2:2:255::4 description AS2-R4
 !
 address-family ipv4
  network 2.2.11.0 mask 255.255.255.0 route-map RM-COMM-CIDR24-IPV4
  network 2.2.12.0 mask 255.255.255.0 route-map RM-COMM-CIDR24-IPV4
  network 2.2.13.0 mask 255.255.255.0 route-map RM-COMM-CIDR24-IPV4
  redistribute connected route-map RM-CONNECTED2BGP-IPV4
  neighbor 2.2.255.1 activate
  neighbor 2.2.255.1 inherit peer-policy IBGP-PEER-POLICY
  neighbor 2.2.255.2 activate
  neighbor 2.2.255.2 inherit peer-policy IBGP-PEER-POLICY
  neighbor 2.2.255.4 activate
  neighbor 2.2.255.4 inherit peer-policy IBGP-PEER-POLICY
  no neighbor 2001:2:2:255::1 activate
  no neighbor 2001:2:2:255::2 activate
  no neighbor 2001:2:2:255::4 activate
 exit-address-family
 !
 address-family vpnv4
  neighbor 2.2.255.1 activate
  neighbor 2.2.255.1 send-community extended
  neighbor 2.2.255.1 inherit peer-policy IBGP-PEER-POLICY
  neighbor 2.2.255.2 activate
  neighbor 2.2.255.2 send-community extended
  neighbor 2.2.255.2 inherit peer-policy IBGP-PEER-POLICY
  neighbor 2.2.255.4 activate
  neighbor 2.2.255.4 send-community extended
  neighbor 2.2.255.4 inherit peer-policy IBGP-PEER-POLICY
 exit-address-family
 !
 address-family ipv6
  redistribute connected route-map RM-CONNECTED2BGP-IPV6
  network 2001:2:2:11::/64
  network 2001:2:2:12::/64
  network 2001:2:2:13::/64
  neighbor IBGP-IPV6 send-community both
  neighbor IBGP-IPV6 route-reflector-client
  neighbor IBGP-IPV6 next-hop-self
  neighbor 2001:2:2:255::1 activate
  neighbor 2001:2:2:255::2 activate
  neighbor 2001:2:2:255::4 activate
 exit-address-family
 !
 address-family vpnv6
  neighbor 2.2.255.1 activate
  neighbor 2.2.255.1 send-community extended
  neighbor 2.2.255.1 inherit peer-policy IBGP-PEER-POLICY
  neighbor 2.2.255.2 activate
  neighbor 2.2.255.2 send-community extended
  neighbor 2.2.255.2 inherit peer-policy IBGP-PEER-POLICY
  neighbor 2.2.255.4 activate
  neighbor 2.2.255.4 send-community extended
  neighbor 2.2.255.4 inherit peer-policy IBGP-PEER-POLICY
 exit-address-family
!
ip forward-protocol nd
!
ip bgp-community new-format
ip community-list standard COMM-TRANSIT-AS4-IPV4 permit 2:1011
ip community-list standard COMM-TRANSIT-AS4-IPV6 permit 2:1012
ip community-list standard COMM-TRANSIT-AS5-IPV4 permit 2:1021
ip community-list standard COMM-TRANSIT-AS5-IPV6 permit 2:1022
ip community-list standard COMM-PEERING-AS123-IPV4 permit 2:2011
ip community-list standard COMM-PEERING-AS123-IPV6 permit 2:2012
ip community-list standard COMM-CLIENTES-PEERING-APENAS-IPV4 permit 2:5001
ip community-list standard COMM-CLIENTES-PEERING-APENAS-IPV6 permit 2:5002
ip community-list standard COMM-CLIENTES-TRANSITO-APENAS-IPV4 permit 2:5003
ip community-list standard COMM-CLIENTES-TRANSITO-APENAS-IPV6 permit 2:5004
ip community-list standard COMM-CLIENTES-TRANSITO-ALL-IPV4 permit 2:10000
ip community-list standard COMM-CLIENTES-TRANSITO-ALL-IPV6 permit 2:11000
ip community-list standard COMM-CLIENTES-RTBH permit 2:666
ip community-list standard COMM-CLIENTES-LOCALPREF-10150 permit 2:10150
ip community-list standard COMM-CLIENTES-LOCALPREF-10190 permit 2:10190
ip community-list standard COMM-AS2-CIDR22-IPV4 permit 2:4011
ip community-list standard COMM-AS2-CIDR23-IPV4 permit 2:4012
ip community-list standard COMM-AS2-CIDR24-IPV4 permit 2:4013
ip community-list standard COMM-AS2-CIDR32-IPV6 permit 2:4021
ip community-list standard COMM-AS2-CIDR33-IPV6 permit 2:4022
ip community-list standard COMM-AS2-CIDR34-IPV6 permit 2:4023
ip community-list standard COMM-NO-EXPORT permit 2:500
ip community-list expanded COMM-AS2-USO-RESTRITO deny ^2:10150$
ip community-list expanded COMM-AS2-USO-RESTRITO deny ^2:10190$
ip community-list expanded COMM-AS2-USO-RESTRITO deny ^2:500$
ip community-list expanded COMM-AS2-USO-RESTRITO deny ^2:501[1-5]$
ip community-list expanded COMM-AS2-USO-RESTRITO deny ^2:502[1-5]$
ip community-list expanded COMM-AS2-USO-RESTRITO deny ^2:666$
ip community-list expanded COMM-AS2-USO-RESTRITO deny ^2:900$
ip community-list expanded COMM-AS2-USO-RESTRITO deny ^2:910$
ip community-list expanded COMM-AS2-USO-RESTRITO deny ^2:921[1-2]$
ip community-list expanded COMM-AS2-USO-RESTRITO deny ^2:9221$
ip community-list expanded COMM-AS2-USO-RESTRITO permit 2:*
ip as-path access-list 1 permit ^$
ip as-path access-list 500 permit _0_
ip as-path access-list 500 permit _23456_
ip as-path access-list 500 permit _(6449[6-9])_|_(6450[0-9])_|_(6451[0-1])_|_(6553[6-9])_|_(6554[0-9])_|_(6555[0-1])_
ip as-path access-list 500 permit _6(4(5(1[2-9]|[2-9][0-9])|[6-9][0-9][0-9])|5([0-4][0-9][0-9]|5([0-2][0-9]|3[0-5])))_
ip as-path access-list 500 permit _6555[2-9]_|_655[6-9][0-9]_|_65[6-9][0-9][0-9]_|_6[6-9][0-9][0-9][0-9]_
ip as-path access-list 500 permit _[7-9][0-9][0-9][0-9][0-9]_|_1[0-2][0-9][0-9][0-9][0-9]_|_130[0-9][0-9][0-9]_
ip as-path access-list 500 permit _1310[0-6][0-9]_|_13107[0-1]_
ip as-path access-list 500 permit _42[0-8][0-9][0-9][0-9][0-9][0-9][0-9][0-9]_
ip as-path access-list 500 permit _(429[0-3][0-9][0-9][0-9][0-9][0-9][0-9])_|_(4294[0-8][0-9][0-9][0-9][0-9][0-9])_
ip as-path access-list 500 permit _(42949[0-5][0-9][0-9][0-9][0-9])_|_(429496[0-6][0-9][0-9][0-9])_
ip as-path access-list 500 permit _(4294967[0-1][0-9][0-9])_|_(42949672[0-8][0-9])_|_(429496729[0-4])_
!
no ip http server
no ip http secure-server
ip route 192.0.2.0 255.255.255.0 Null0 name RTBH
!
ip access-list standard LDP_acl
 permit 2.2.255.0 0.0.0.255
!
ip access-list extended CoPP-BGP-UNTRUSTED-ACL
 permit tcp any any eq bgp
 permit tcp any eq bgp any
ip access-list extended CoPP-IBGP-ACL
 permit tcp 2.2.255.0 0.0.0.255 any eq bgp
 permit tcp 2.2.255.0 0.0.0.255 eq bgp any
!
!
ip prefix-list PL-BOGONS-IPV4 seq 5 permit 0.0.0.0/8 le 32
ip prefix-list PL-BOGONS-IPV4 seq 10 permit 10.0.0.0/8 le 32
ip prefix-list PL-BOGONS-IPV4 seq 15 permit 100.64.0.0/10 le 32
ip prefix-list PL-BOGONS-IPV4 seq 20 permit 127.0.0.0/8 le 32
ip prefix-list PL-BOGONS-IPV4 seq 25 permit 169.254.0.0/16 le 32
ip prefix-list PL-BOGONS-IPV4 seq 30 permit 172.16.0.0/12 le 32
ip prefix-list PL-BOGONS-IPV4 seq 35 permit 192.0.0.0/2
ip prefix-list PL-BOGONS-IPV4 seq 40 permit 192.0.2.0/24 le 32
ip prefix-list PL-BOGONS-IPV4 seq 45 permit 192.88.99.0/24 le 32
ip prefix-list PL-BOGONS-IPV4 seq 50 permit 192.168.0.0/16 le 32
ip prefix-list PL-BOGONS-IPV4 seq 55 permit 198.18.0.0/15 le 32
ip prefix-list PL-BOGONS-IPV4 seq 60 permit 198.51.100.0/24 le 32
ip prefix-list PL-BOGONS-IPV4 seq 65 permit 203.0.113.0/24 le 32
ip prefix-list PL-BOGONS-IPV4 seq 70 permit 224.0.0.0/4 le 32
ip prefix-list PL-BOGONS-IPV4 seq 75 permit 240.0.0.0/4 le 32
ip prefix-list PL-BOGONS-IPV4 seq 80 permit 255.255.255.255/32
!
ip prefix-list PL-CONNECTED2BGP-IPV4 seq 5 permit 2.2.14.0/24
ip prefix-list PL-CONNECTED2BGP-IPV4 seq 10 permit 2.2.15.0/24
ip prefix-list PL-CONNECTED2BGP-IPV4 seq 15 permit 2.2.16.0/24
!
ip prefix-list PL-DFZ-IPV4 seq 5 permit 0.0.0.0/0 le 24
!
!
ipv6 prefix-list PL-BOGONS-IPV6 seq 5 permit ::/8 le 128
ipv6 prefix-list PL-BOGONS-IPV6 seq 10 permit ::/128
ipv6 prefix-list PL-BOGONS-IPV6 seq 15 permit ::1/128
ipv6 prefix-list PL-BOGONS-IPV6 seq 20 permit ::FFFF:0.0.0.0/96 le 128
ipv6 prefix-list PL-BOGONS-IPV6 seq 25 permit 64:FF9B:1::/48 le 128
ipv6 prefix-list PL-BOGONS-IPV6 seq 30 permit 100::/64 le 128
ipv6 prefix-list PL-BOGONS-IPV6 seq 35 permit 2001:2::/48 le 128
ipv6 prefix-list PL-BOGONS-IPV6 seq 40 permit 2001:10::/28 le 128
ipv6 prefix-list PL-BOGONS-IPV6 seq 45 permit 2001:DB8::/32 le 128
ipv6 prefix-list PL-BOGONS-IPV6 seq 50 permit 2002::/16 le 128
ipv6 prefix-list PL-BOGONS-IPV6 seq 55 permit 3FFE::/16 le 128
ipv6 prefix-list PL-BOGONS-IPV6 seq 60 permit 5F00::/16 le 128
ipv6 prefix-list PL-BOGONS-IPV6 seq 65 permit 3FFF::/20 le 128
ipv6 prefix-list PL-BOGONS-IPV6 seq 70 permit FC00::/7 le 128
ipv6 prefix-list PL-BOGONS-IPV6 seq 75 permit FE80::/10 le 128
ipv6 prefix-list PL-BOGONS-IPV6 seq 80 permit FEC0::/10 le 128
ipv6 prefix-list PL-BOGONS-IPV6 seq 85 permit FF00::/8 le 128
!
ipv6 prefix-list PL-CONNECTED2BGP-IPV6 seq 5 permit 2001:2:2:14::/64
ipv6 prefix-list PL-CONNECTED2BGP-IPV6 seq 10 permit 2001:2:2:15::/64
ipv6 prefix-list PL-CONNECTED2BGP-IPV6 seq 15 permit 2001:2:2:16::/64
!
ipv6 prefix-list PL-DFZ-IPV6 seq 5 permit ::/0 le 48
route-map RM-COMM-CIDR23-IPV4 permit 10
 set community 2:4012
!
route-map RM-COMM-CIDR22-IPV4 permit 10
 set community 2:4011
!
route-map RM-COMM-CIDR32-IPV6 permit 10
 set community 2:4021
!
route-map RM-COMM-CIDR33-IPV6 permit 10
 set community 2:4022
!
route-map RM-CONNECTED2BGP-IPV4 permit 10
 match ip address prefix-list PL-CONNECTED2BGP-IPV4
 set community 2:4013
!
route-map RM-COMM-CIDR34-IPV6 permit 10
 set community 2:4023
!
route-map RM-CONNECTED2BGP-IPV6 permit 10
 match ipv6 address prefix-list PL-CONNECTED2BGP-IPV6
!
route-map RM-COMM-CIDR24-IPV4 permit 10
 set community 2:4013
!
!
mpls ldp router-id Loopback0
!
control-plane
 service-policy input CoPP-AS2
!
!
!
!
!
!
!
!
line con 0
 exec-timeout 0 0
 logging synchronous
line aux 0
line vty 0 4
 privilege level 15
 login local
 transport input telnet ssh
!
!
end